// examples/advanced/web-server-with-concurrency.sfn

import { serve } from "sail/http";
import { sleep } from "sail/time";

fn handleRequest(req, res) {
    if req.path == "/compute" {
        routine {
            let result = computeHeavyTask();
            res.send("Computed result: {{result}}");
        }
    } else {
        res.send("Welcome to Sailfin!", 200);
    }
}

fn computeHeavyTask() -> number {
    sleep(2000);
    return 42;
}

fn main() {
    serve(handleRequest, { port: 8080 });
    print.info("Server is running on http://localhost:8080");
}
